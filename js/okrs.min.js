$.ajaxSetup({
    headers: {
        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
    }
});

function Filtrar() {
    $("#formulario_filtro").submit();
}

function LimpiarFormulario() {
    $("#vicepresidencia_fill").val('');
    $("#areas_fill").val('');
    $("#responsable_fill").val('');
    $("#objestrategico_fill").val('');
    $("#okr_fill").val('');
    $("#tipo_okr_fill").val('');
    $("#Q1").val('');
    $("#Q2").val('');
    $("#Q3").val('');
    $("#Q4").val('');
    $("#Q5").val('');
    $("#Anual").val('');
    $("#formulario_filtro").submit();
}

function Profile(id, val) {
    var tipo = 'get';
    $.ajax({
        url: "profileEmpleado",
        type: "get",
        data: {
            _method: tipo, id: id,
            val: val
        },
        success: function (data) {
            $("#profileModal").modal('show');
            $("#contentProfile").html(data);
        }
    });
}

function VerIniciativa(idResultado, pagina, idIniciativa) {
    var tipo = 'get';
    var page = location.href;
    var consulta = new URLSearchParams(window.location.search);
    if(consulta != ''){
        var locacion = page + "&resultado_okr_=" + idResultado;
    }else{
        var locacion = page + "?resultado_okr_=" + idResultado;
    }
    $.ajax({
        url: "verIniciativa",
        type: "get",
        data: {
            _method: tipo,
            idResultado: idResultado,
            pagina: pagina,
            idIniciativa: idIniciativa
        },
        success: function (data) {
            $("#iniciativaModal").modal('show');
            $("#headerModal").html(data['header']);
            $("#id_resultado").val(data['id_resultado']);
            $("#id_registro").val(data['id_registro']);
            $("#id_okr").val(data['id_okrs']);
            $("#id_iniciativa").val(data['id_iniciaTIVA']);
            $("#descripcion").val(data['descripcion']);
            $("#fecha_entrega").val(data['fecha_entrega']);
            $("#meta").html(data['meta']);
            $("#tendencia").html(data['tendencia']);
            $("#responsables").html(data['responsables']);
            $("#lista_responsables").html(data['divResponsables']);
            $("#pagina").val(locacion);
            // $("#contentOkr").html(data);
        }
    });
}

function Guardar_Avance_Resultado(avance, id, id_okr, id_empresa, id_user, pages) {

    var tipo = 'post';
    var page = location.href;
    var consulta = new URLSearchParams(window.location.search);
    
    $.ajax({
        url: "guardarAvanceResultado",
        type: "post",
        data: {
            _method: tipo,
            id: id,
            id_okr: id_okr,
            id_empresa: id_empresa,
            id_user: id_user,
            avance: avance
        },
        success: function (data) {
            if (data == 'true') {
                toastr.success("Avance guardado con exito");
                // if(consulta != ''){
                //     window.location = page + "&resultado_okr_=" + id;
                // }else{
                //     window.location = pages +"&resultado_okr_=" + id;
                // }
            } else {
                toastr.error("Hubo un error al guardar el avance del resultado.");
            }
            // window.location = page+"&resultado_okr_="+id;         
        }
    });

}

function Guardar_Avance_Iniciativa(avance, id, id_okr, id_resultado, id_empresa, id_user, page) {

    var tipo = 'post';
    var page = location.href;
    var consulta = new URLSearchParams(window.location.search);
    $.ajax({
        url: "guardarAvanceIniciativa",
        type: "post",
        data: {
            _method: tipo,
            id: id,
            id_resultado: id_resultado,
            id_okr: id_okr,
            id_empresa: id_empresa,
            id_user: id_user,
            avance: avance
        },
        success: function (data) {
            if (data == 'true') {
                toastr.success("Avance guardado con exito");
                // if(consulta != ''){
                //     window.location = page + "&resultado_okr_=" + id_resultado + "&iniciativa=" + id;
                // }else{
                //     window.location = pages +"&resultado_okr_=" + id_resultado + "&iniciativa=" + id;
                // }                
            } else {
                toastr.error("Hubo un error al guardar el avance de la iniciativa.");
            }
            // window.location = page+"&resultado_okr_="+id;         
        }
    });

}

function GuardarAvances(id,pages){
    var page = location.href;
    var consulta = new URLSearchParams(window.location.search);
    if(consulta != ''){
        window.location = page + "&resultado_okr_=" + id;
    }else{
        window.location = pages +"&resultado_okr_=" + id;
    }
}

$('#areas_fill').select2({
    theme: "bootstrap-5",
    width: $(this).data('width') ? $(this).data('width') : $(this).hasClass('w-100') ? '100%' : 'style',
    placeholder: $(this).data('placeholder'),
});

$('#vicepresidencia_fill').select2({
    theme: "bootstrap-5",
    width: $(this).data('width') ? $(this).data('width') : $(this).hasClass('w-100') ? '100%' : 'style',
    placeholder: $(this).data('placeholder'),
});

$('#objestrategico_fill').select2({
    theme: "bootstrap-5",
    width: $(this).data('width') ? $(this).data('width') : $(this).hasClass('w-100') ? '100%' : 'style',
    placeholder: $(this).data('placeholder'),
});
$('#responsable_fill').select2({
    theme: "bootstrap-5",
    width: $(this).data('width') ? $(this).data('width') : $(this).hasClass('w-100') ? '100%' : 'style',
    placeholder: $(this).data('placeholder'),
});
$('#okr_fill').select2({
    theme: "bootstrap-5",
    width: $(this).data('width') ? $(this).data('width') : $(this).hasClass('w-100') ? '100%' : 'style',
    placeholder: $(this).data('placeholder'),
});

$('#fecha_entrega').attr('min', moment().format('YYYY-MM-DD'));

// $('#fecha_entrega').on('change', function(e){
//     var startDate = $(this).val();
//     var endDate = moment(startDate).add(2, 'days').format('YYYY-MM-DD');
//     $('#enddate').attr('min', endDate);
//   })