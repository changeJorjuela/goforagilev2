$.ajaxSetup({
    headers: {
        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
    }
});

function Filtrar() {
    $("#formulario_filtro").submit();
}

function LimpiarFormulario() {
    $("#vicepresidencia_fill").val('');
    $("#areas_fill").val('');
    $("#responsable_fill").val('');
    $("#objestrategico_fill").val('');
    $("#okr_fill").val('');
    $("#tipo_okr_fill").val('');
    $("#Q1").val('');
    $("#Q2").val('');
    $("#Q3").val('');
    $("#Q4").val('');
    $("#Q5").val('');
    $("#Anual").val('');
    $("#formulario_filtro").submit();
}

function Profile(id, val) {
    var tipo = 'get';
    $.ajax({
        url: "profileEmpleado",
        type: "get",
        data: {
            _method: tipo, id: id,
            val: val
        },
        success: function (data) {
            $("#profileModal").modal('show');
            $("#contentProfile").html(data);
        }
    });
}

function VerIniciativa(idResultado, pagina, idIniciativa) {
    var tipo = 'get';
    var page = location.href;
    var consulta = new URLSearchParams(window.location.search);
    if (consulta != '') {
        var locacion = page + "&resultado_okr_=" + idResultado;
    } else {
        var locacion = page + "?resultado_okr_=" + idResultado;
    }
    $.ajax({
        url: "verIniciativa",
        type: "get",
        data: {
            _method: tipo,
            idResultado: idResultado,
            pagina_ini: pagina,
            idIniciativa: idIniciativa
        },
        success: function (data) {
            $("#iniciativaModal").modal('show');
            $("#headerModalIniciativa").html(data['header_ini']);
            $("#id_resultado_ini").val(data['id_resultado_ini']);
            $("#id_okr_ini").val(data['id_okrs_ini']);
            $("#id_iniciativa").val(data['id_iniciativa']);
            $("#descripcion_ini").val(data['descripcion_ini']);
            $("#fecha_entrega_ini").val(data['fecha_entrega_ini']);
            $("#meta_ini").val(data['meta_ini']);
            $("#tendencia_ini").html(data['tendencia_ini']);
            $("#responsables_ini").html(data['responsables_ini']);
            $("#lista_responsables_ini").html(data['divResponsables_ini']);
            $("#pagina_ini").val(locacion);
            if (data['requerido_ini'] == '0') {
                $('#fecha_entrega_ini').attr('min', moment().format('YYYY-MM-DD'));
            }
            // $("#contentOkr").html(data);
        }
    });
}

function VerResultado(idOkr, pagina, idResultado) {
    var tipo = 'get';
    var page = location.href;
    var consulta = new URLSearchParams(window.location.search);
    if (consulta != '') {
        var locacion = page + "&resultado_okr_=" + idResultado;
    } else {
        var locacion = page + "?resultado_okr_=" + idResultado;
    }
    $.ajax({
        url: "verKr",
        type: "get",
        data: {
            _method: tipo,
            idResultado: idResultado,
            pagina_kr: pagina,
            idOkr: idOkr
        },
        success: function (data) {
            $("#krModal").modal('show');
            $("#headerModalResultado").html(data['header_kr']);
            $("#id_resultado").val(data['id_resultado']);
            $("#id_okr_kr").val(data['id_okr_kr']);
            $("#descripcion_kr").val(data['descripcion_kr']);
            $("#fecha_inicia_kr").val(data['fecha_inicia_kr']);
            $("#fecha_entrega_kr").val(data['fecha_entrega_kr']);
            $("#meta_kr").val(data['meta_kr']);
            $("#meta_minima_kr").val(data['meta_minima_kr']);
            $("#meta_maxima_kr").val(data['meta_maxima_kr']);
            $("#tendencia_kr").html(data['tendencia_kr']);
            $("#periodo_kr").html(data['periodo_kr']);
            $("#medicion_kr").html(data['medicion_kr']);
            $("#responsables_kr").html(data['responsables_kr']);
            $("#lista_responsables_kr").html(data['divResponsables_kr']);
            $("#pagina_kr").val(locacion);
            if (data['requerido_kr'] == '0') {
                $('#fecha_inicia_kr').attr('min', moment().format('YYYY-MM-DD'));
                $('#fecha_inicia_kr').on('change', function (e) {
                    var startDate = $(this).val();
                    var endDate = moment(startDate).add(2, 'days').format('YYYY-MM-DD');
                    $('#fecha_entrega_kr').attr('min', endDate);
                })
            }
            // $("#contentOkr").html(data);
        }
    });
}

function Guardar_Avance_Resultado(avance, id, id_okr, id_empresa, id_user, pages) {

    var tipo = 'post';
    var page = location.href;
    var consulta = new URLSearchParams(window.location.search);

    $.ajax({
        url: "guardarAvanceResultado",
        type: "post",
        data: {
            _method: tipo,
            id: id,
            id_okr: id_okr,
            id_empresa: id_empresa,
            id_user: id_user,
            avance: avance
        },
        success: function (data) {
            if (data == 'true') {
                toastr.success("Avance guardado con exito");
                // if(consulta != ''){
                //     window.location = page + "&resultado_okr_=" + id;
                // }else{
                //     window.location = pages +"&resultado_okr_=" + id;
                // }
            } else {
                toastr.error("Hubo un error al guardar el avance del resultado.");
            }
            // window.location = page+"&resultado_okr_="+id;         
        }
    });

}

function Guardar_Avance_Iniciativa(avance, id, id_okr, id_resultado, id_empresa, id_user, page) {

    var tipo = 'post';
    var page = location.href;
    var consulta = new URLSearchParams(window.location.search);
    $.ajax({
        url: "guardarAvanceIniciativa",
        type: "post",
        data: {
            _method: tipo,
            id: id,
            id_resultado: id_resultado,
            id_okr: id_okr,
            id_empresa: id_empresa,
            id_user: id_user,
            avance: avance
        },
        success: function (data) {
            if (data == 'true') {
                toastr.success("Avance guardado con exito");
                // if(consulta != ''){
                //     window.location = page + "&resultado_okr_=" + id_resultado + "&iniciativa=" + id;
                // }else{
                //     window.location = pages +"&resultado_okr_=" + id_resultado + "&iniciativa=" + id;
                // }                
            } else {
                toastr.error("Hubo un error al guardar el avance de la iniciativa.");
            }
            // window.location = page+"&resultado_okr_="+id;         
        }
    });

}

function GuardarAvances(id, pages) {
    var page = location.href;
    var consulta = new URLSearchParams(window.location.search);
    if (consulta != '') {
        window.location = page + "&resultado_okr_=" + id;
    } else {
        window.location = pages + "&resultado_okr_=" + id;
    }
}

$('#areas_fill').select2({
    theme: "bootstrap-5",
    width: $(this).data('width') ? $(this).data('width') : $(this).hasClass('w-100') ? '100%' : 'style',
    placeholder: $(this).data('placeholder'),
});

$('#vicepresidencia_fill').select2({
    theme: "bootstrap-5",
    width: $(this).data('width') ? $(this).data('width') : $(this).hasClass('w-100') ? '100%' : 'style',
    placeholder: $(this).data('placeholder'),
});

$('#objestrategico_fill').select2({
    theme: "bootstrap-5",
    width: $(this).data('width') ? $(this).data('width') : $(this).hasClass('w-100') ? '100%' : 'style',
    placeholder: $(this).data('placeholder'),
});
$('#responsable_fill').select2({
    theme: "bootstrap-5",
    width: $(this).data('width') ? $(this).data('width') : $(this).hasClass('w-100') ? '100%' : 'style',
    placeholder: $(this).data('placeholder'),
});
$('#okr_fill').select2({
    theme: "bootstrap-5",
    width: $(this).data('width') ? $(this).data('width') : $(this).hasClass('w-100') ? '100%' : 'style',
    placeholder: $(this).data('placeholder'),
});



function decimalMetaNumber(element, event) {
    result = (event.charCode >= 48 && event.charCode <= 57) || event.charCode === 46;
    if (result) {
        let t = element.value;
        if (t === '' && event.charCode === 46) {
            return false;
        }
        let dotIndex = t.indexOf(".");
        let valueLength = t.length;
        if (dotIndex > 0) {
            if (dotIndex + 2 < valueLength) {
                return false;
            } else {
                return true;
            }
        } else if (dotIndex === 0) {
            return false;
        } else {
            return true;
        }
    } else {
        return false;
    }
}